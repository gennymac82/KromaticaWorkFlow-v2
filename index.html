<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kromatica Cash Flow</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <style>
    :root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--line:#1f2a44;--accent:#22c55e}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;background:var(--bg);color:#e5e7eb}
    .wrap{max-width:900px;margin:0 auto;padding:20px}
    .nav{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:var(--card);color:#e5e7eb;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--accent);color:#04100a;border:0;font-weight:700}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.25);margin-top:12px}
    label{display:block;font-size:14px;color:#e2e8f0;margin:8px 0 6px}
    input,select{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #334155;background:#111827;color:#e5e7eb}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .muted{font-size:12px;color:var(--muted)}
    .table{width:100%;border-collapse:collapse;font-size:14px}
    .table th,.table td{border-bottom:1px solid var(--line);padding:8px 6px;text-align:left}
    .hidden{display:none}
    .space{height:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸ“’ Kromatica Cash Flow</h1>

    <div class="nav">
      <button class="btn" data-route="home">Home</button>
      <button class="btn" data-route="riepilogo">Riepilogo movimenti</button>
      <button class="btn" data-route="saldo">Saldo mensile</button>
      <button class="btn primary" id="installBtn" title="Installa sul dispositivo">Installa</button>
    </div>

    <!-- HOME -->
    <section id="page-home" class="card">
      <h2>Nuovo movimento</h2>
      <form id="cashForm">
        <label>Data</label>
        <input type="date" id="date" required />

        <label>Descrizione</label>
        <input type="text" id="description" placeholder="Es. Anticipo wedding G.&R." required />

        <label>Categoria</label>
        <select id="category" required>
          <option value="Collaboratori">Collaboratori</option>
          <option value="Famiglia">Famiglia</option>
          <option value="Motori">Motori</option>
          <option value="Fototessera">Fototessera</option>
          <option value="Tasse">Tasse</option>
        </select>

        <div class="row">
          <div>
            <label>Entrata (â‚¬)</label>
            <input type="number" step="0.01" id="income" placeholder="0.00" />
          </div>
          <div>
            <label>Uscita (â‚¬)</label>
            <input type="number" step="0.01" id="expense" placeholder="0.00" />
          </div>
        </div>

        <button type="submit" class="btn primary" style="width:100%;margin-top:12px">ðŸ’¾ Salva</button>
        <div class="muted" id="status"></div>
      </form>
    </section>

    <!-- RIEPILOGO -->
    <section id="page-riepilogo" class="card hidden">
      <h2>Riepilogo movimenti</h2>
      <div class="row">
        <div>
          <label>Mese</label>
          <input type="month" id="repMonth" />
        </div>
        <div>
          <label>Categoria (facoltativa)</label>
          <select id="repCategory">
            <option value="">Tutte</option>
            <option value="Collaboratori">Collaboratori</option>
            <option value="Famiglia">Famiglia</option>
            <option value="Motori">Motori</option>
            <option value="Fototessera">Fototessera</option>
            <option value="Tasse">Tasse</option>
          </select>
        </div>
      </div>
      <div class="space"></div>
      <button class="btn" id="btnLoadList">Carica movimenti</button>
      <div class="space"></div>
      <div id="repContainer"></div>
    </section>

    <!-- SALDO -->
    <section id="page-saldo" class="card hidden">
      <h2>Saldo mensile</h2>
      <div class="row">
        <div>
          <label>Mese</label>
          <input type="month" id="sumMonth" />
        </div>
      </div>
      <div class="space"></div>
      <button class="btn" id="btnLoadSummary">Calcola saldo</button>
      <div class="space"></div>
      <div id="sumContainer" class="muted"></div>
    </section>
  </div>

  <script src="app.js"></script>
  <script>
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault(); deferredPrompt = e; document.getElementById('installBtn').disabled = false;
    });
    document.getElementById('installBtn').addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt(); deferredPrompt = null;
    });
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
  </script>
</body>
</html>
